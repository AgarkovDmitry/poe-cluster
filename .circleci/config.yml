version: 2.1
orbs:
  node: circleci/node@3.0.0
jobs:
    prepare-dependencies:
    steps:
        - checkout
        - run:
              name: Compute version number
              command: echo "0.0.${CIRCLE_BUILD_NUM}-${CIRCLE_SHA1:0:7}" | tee version.txt
        - restore_cache:
              keys:
                  - yarn-deps-{{ checksum "yarn.lock" }}
                  - yarn-deps
        - run:
              name: yarn install
              command: yarn install
        - save_cache:
              paths:
                  - node_modules
              key: yarn-deps-{{ checksum "yarn.lock" }}-{{ epoch }}
        - store_artifacts:
              path: yarn.lock
        - persist_to_workspace:
              root: .
              paths:
                  - .
workflows:
  node-tests:
    jobs:
      - node/test
